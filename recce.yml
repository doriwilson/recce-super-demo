# Preset Checks
# Please see https://docs.datarecce.io/features/preset-checks/
checks:
- name: Row count diff
  description: Check the row count diff for all table models.
  type: row_count_diff
  params:
    select: state:modified,config.materialized:table
- name: Schema diff
  description: Check the schema diff for all nodes.
  type: schema_diff
- name: Customer Orders UTC Date Validation
  description: Validates UTC date conversion in customer_orders. Automatically runs when customer_orders or its upstream dependencies change. Recce compares first_order_date and last_order_date between base and target - validate that shifts are only 0 or ±1 day (JST→UTC conversion).
  type: query
  params:
    sql_template: |
      -- This query returns date columns for comparison
      -- Recce runs this in both base (prod) and target (dev) schemas
      -- In the Recce UI diff view, check that date shifts are within expected bounds:
      -- - For JST→UTC: dates can shift backward by 0 or 1 day (UTC+9 → UTC)
      -- - Shifts >1 day in either direction indicate a problem
      select
        customer_id,
        first_order_date,
        last_order_date,
        order_count
      from {{ ref('customer_orders') }}
      order by customer_id
    view_options:
      primary_keys:
        - customer_id
  # This check automatically runs when customer_orders or upstream models change
  # Recce will show the diff between base and target date values
  # Validation: Check that first_order_date and last_order_date shifts are 0 or ±1 day
  # For JST→UTC: backward shifts (-1 day) are expected when dates cross UTC midnight
